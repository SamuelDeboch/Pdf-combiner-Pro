<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Combiner - Register & Login</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Auth Container */
        .auth-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 450px;
            overflow: hidden;
        }

        .auth-header {
            background: linear-gradient(135deg, #2c3e50 0%, #1a2530 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .auth-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .auth-header p {
            opacity: 0.8;
        }

        .auth-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .auth-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
        }

        .auth-tab.active {
            color: #6a11cb;
            background: white;
            border-bottom: 3px solid #6a11cb;
        }

        .auth-form {
            padding: 40px;
        }

        .auth-form.hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus {
            border-color: #6a11cb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }

        .password-container {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
        }

        .auth-btn {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }

        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .auth-message.error {
            background: #fee;
            color: #c00;
            border: 1px solid #fcc;
        }

        .auth-message.success {
            background: #efe;
            color: #0a0;
            border: 1px solid #cfc;
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9rem;
        }

        .password-requirements {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }

        .requirement {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 3px;
        }

        .requirement.valid {
            color: #0a0;
        }

        .requirement.invalid {
            color: #c00;
        }

        .requirement-icon {
            font-size: 0.9rem;
        }

        /* Main Application */
        .app-container {
            display: none;
            width: 100%;
            max-width: 1200px;
        }

        .app-container.active {
            display: block;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* Header with user info */
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #1a2530 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Main content styles */
        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Upload Section */
        .upload-area {
            border: 3px dashed #6a11cb;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            background: #f0f4ff;
            border-color: #2575fc;
            transform: translateY(-2px);
        }

        .upload-area i {
            font-size: 4rem;
            color: #6a11cb;
            margin-bottom: 20px;
        }

        .upload-area h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .upload-area p {
            color: #666;
            margin-bottom: 15px;
        }

        #fileInput {
            display: none;
        }

        .file-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .file-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #6a11cb;
        }

        .file-info {
            flex-grow: 1;
        }

        .file-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            word-break: break-all;
        }

        .file-size {
            color: #666;
            font-size: 0.9rem;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .file-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }

        .file-actions .delete-btn {
            color: #e74c3c;
        }

        .file-actions .delete-btn:hover {
            background: #ffeaea;
        }

        .file-actions .move-btn {
            color: #3498db;
            cursor: move;
        }

        /* Separation Pages Section */
        .separation-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .separation-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .separation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }

        .preset-btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 15px;
            background: #e8eaf6;
            border: 2px solid #6a11cb;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: #6a11cb;
            color: white;
        }

        .separations-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .separation-item {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .separation-text {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .separation-position {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .separation-actions {
            display: flex;
            gap: 10px;
        }

        .separation-actions button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .separation-actions button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Preview Section */
        .preview-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .preview-item {
            padding: 15px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .preview-item.pdf {
            border-left: 4px solid #6a11cb;
        }

        .preview-item.separation {
            border-left: 4px solid #4facfe;
        }

        .preview-icon {
            font-size: 1.5rem;
            color: #6a11cb;
        }

        .preview-icon.separation {
            color: #4facfe;
        }

        .preview-content {
            flex-grow: 1;
        }

        .preview-title {
            font-weight: 600;
            color: #2c3e50;
        }

        .preview-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        /* Controls Section */
        .controls-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .controls-section {
                grid-template-columns: 1fr;
            }
        }

        .output-options {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus {
            border-color: #6a11cb;
            outline: none;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-btn {
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(106, 17, 203, 0.4);
        }

        .action-btn.secondary {
            background: #f8f9fa;
            color: #2c3e50;
            border: 2px solid #6a11cb;
        }

        .action-btn.secondary:hover {
            background: #6a11cb;
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2c3e50;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .color-picker input[type="color"] {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        /* Progress Bar */
        .progress-container {
            display: none;
            margin-top: 20px;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .progress-bar {
            height: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-details {
            color: #666;
            font-size: 0.9rem;
        }

        /* Page counter */
        .page-counter {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .page-counter h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .page-counter .count {
            font-size: 2rem;
            font-weight: 700;
            color: #6a11cb;
        }

        /* Drag and drop styling */
        .dragging {
            opacity: 0.5;
        }

        .drag-over {
            background: #f0f4ff !important;
            border-color: #2575fc !important;
        }

        /* Status messages */
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            margin-top: 30px;
        }

        /* User Profile Modal */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .profile-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            padding: 30px;
        }

        .profile-content h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .profile-info {
            margin-bottom: 30px;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .profile-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .profile-label {
            color: #666;
            font-weight: 600;
        }

        .profile-value {
            color: #2c3e50;
        }

        /* Users Management Modal (Admin only) */
        .users-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .users-content {
            background: white;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            border-radius: 15px;
            padding: 30px;
            overflow-y: auto;
        }

        .users-list {
            margin-top: 20px;
        }

        .user-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-email {
            font-weight: 600;
            color: #2c3e50;
        }

        .user-date {
            color: #666;
            font-size: 0.9rem;
        }

        .user-role {
            background: #e8eaf6;
            color: #6a11cb;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Admin Panel */
        .admin-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .admin-panel.open {
            transform: translateX(0);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .admin-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6a11cb;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #6a11cb;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-toggle:hover {
            background: #2575fc;
        }

        /* Admin buttons in header */
        .admin-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .admin-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-header">
            <h1><i>üîê</i> PDF Combiner Pro</h1>
            <p>Secure PDF combining with user accounts</p>
        </div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login">Login</button>
            <button class="auth-tab" data-tab="register">Register</button>
        </div>
        
        <!-- Login Form -->
        <div class="auth-form" id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" placeholder="Enter your email" required>
            </div>
            
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <div class="password-container">
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    <button type="button" class="toggle-password" data-target="loginPassword">üëÅÔ∏è</button>
                </div>
            </div>
            
            <div class="form-group checkbox-group">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe">Remember me</label>
            </div>
            
            <button type="button" class="auth-btn" id="loginBtn">Sign In</button>
            
            <div class="auth-message" id="loginMessage"></div>
            
            <div class="auth-footer">
                <p>Don't have an account? <a href="#" id="showRegister">Register here</a></p>
                <p>Demo account: admin@example.com / password123</p>
            </div>
        </div>
        
        <!-- Register Form -->
        <div class="auth-form hidden" id="registerForm">
            <div class="form-group">
                <label for="registerName">Full Name</label>
                <input type="text" id="registerName" placeholder="Enter your full name" required>
            </div>
            
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" placeholder="Enter your email" required>
            </div>
            
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <div class="password-container">
                    <input type="password" id="registerPassword" placeholder="Create a password" required>
                    <button type="button" class="toggle-password" data-target="registerPassword">üëÅÔ∏è</button>
                </div>
                <div class="password-requirements">
                    <div class="requirement" id="reqLength">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>At least 8 characters</span>
                    </div>
                    <div class="requirement" id="reqUppercase">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>One uppercase letter</span>
                    </div>
                    <div class="requirement" id="reqLowercase">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>One lowercase letter</span>
                    </div>
                    <div class="requirement" id="reqNumber">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>One number</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="registerConfirmPassword">Confirm Password</label>
                <div class="password-container">
                    <input type="password" id="registerConfirmPassword" placeholder="Confirm your password" required>
                    <button type="button" class="toggle-password" data-target="registerConfirmPassword">üëÅÔ∏è</button>
                </div>
            </div>
            
            <button type="button" class="auth-btn" id="registerBtn">Create Account</button>
            
            <div class="auth-message" id="registerMessage"></div>
            
            <div class="auth-footer">
                <p>Already have an account? <a href="#" id="showLogin">Login here</a></p>
                <p>By registering, you agree to our Terms of Service</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <div class="container">
            <header>
                <div class="header-left">
                    <h1><i>üìö</i> PDF Combiner Pro</h1>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span id="userName">User</span>
                    </div>
                </div>
                <div class="admin-buttons">
                    <button class="admin-btn" id="profileBtn">üë§ Profile</button>
                    <button class="admin-btn" id="usersBtn" style="display: none;">üë• Users</button>
                    <button class="logout-btn" id="logoutBtn">
                        <i>üö™</i> Logout
                    </button>
                    <button class="admin-toggle" id="adminToggle">‚öôÔ∏è</button>
                </div>
            </header>

            <!-- Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <div class="admin-header">
                    <h3>Admin Panel</h3>
                    <button class="admin-close" id="adminClose">&times;</button>
                </div>
                
                <div class="admin-section">
                    <h4>User Information</h4>
                    <div class="admin-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="userRole">User</span>
                            <span class="stat-label">Role</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="sessionTime">0m</span>
                            <span class="stat-label">Session Time</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="pdfCount">0</span>
                            <span class="stat-label">PDFs Uploaded</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="combineCount">0</span>
                            <span class="stat-label">Combines Done</span>
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h4>Quick Actions</h4>
                    <button class="action-btn secondary" style="width: 100%; margin-bottom: 10px;" id="changePasswordBtn">
                        <i>üîë</i> Change Password
                    </button>
                    <button class="action-btn secondary" style="width: 100%; margin-bottom: 10px;" id="exportDataBtn">
                        <i>üì§</i> Export My Data
                    </button>
                    <button class="action-btn secondary" style="width: 100%;" id="clearDataBtn">
                        <i>üóëÔ∏è</i> Clear All My Data
                    </button>
                </div>
                
                <div class="admin-section">
                    <h4>System Info</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <p style="margin-bottom: 5px;"><strong>Version:</strong> 2.0.0</p>
                        <p style="margin-bottom: 5px;"><strong>Storage Used:</strong> <span id="storageUsed">0 KB</span></p>
                        <p><strong>Users Online:</strong> <span id="usersOnline">1</span></p>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <!-- Upload Section -->
                <div class="section">
                    <h2><i>üì§</i> Upload PDF Files</h2>
                    <div class="upload-area" id="dropArea">
                        <i>üìÑ</i>
                        <h3>Drag & Drop PDF Files Here</h3>
                        <p>or click to browse files</p>
                        <input type="file" id="fileInput" accept=".pdf" multiple>
                        <p>Max 10 files ‚Ä¢ Max 50MB each</p>
                    </div>
                    
                    <div class="page-counter">
                        <h4>Total Pages in Combined PDF</h4>
                        <div class="count" id="totalPagesCount">0</div>
                    </div>
                    
                    <div id="fileList" class="file-list"></div>
                    
                    <div class="status-message" id="uploadStatus"></div>
                </div>

                <!-- Separation Pages Section -->
                <div class="section">
                    <h2><i>üìù</i> Separation Pages</h2>
                    <p style="margin-bottom: 20px; color: #666;">Add custom pages between your PDFs with any text you want.</p>
                    
                    <div class="separation-controls">
                        <button class="separation-btn" id="addSeparationBtn">
                            <i>‚ûï</i> Add Separation Page
                        </button>
                        
                        <div class="preset-btns">
                            <button class="preset-btn" data-text="Section Break">Section</button>
                            <button class="preset-btn" data-text="Chapter">Chapter</button>
                            <button class="preset-btn" data-text="Appendix">Appendix</button>
                        </div>
                    </div>
                    
                    <div id="separationsList" class="separations-list"></div>
                    
                    <div class="status-message" id="separationStatus"></div>
                </div>

                <!-- Preview Section -->
                <div class="section" style="grid-column: 1 / -1;">
                    <h2><i>üëÅÔ∏è</i> Preview Order</h2>
                    <p style="margin-bottom: 20px; color: #666;">Drag items to reorder. PDFs are shown in blue, separation pages in teal.</p>
                    <div id="previewList" class="preview-list"></div>
                </div>

                <!-- Controls Section -->
                <div class="controls-section">
                    <div class="output-options">
                        <h2><i>‚öôÔ∏è</i> Output Options</h2>
                        
                        <div class="form-group">
                            <label for="outputName">Output Filename:</label>
                            <input type="text" id="outputName" value="combined-document.pdf">
                        </div>
                        
                        <div class="form-group">
                            <label for="pageSize">Page Size for Separations:</label>
                            <select id="pageSize" class="form-control">
                                <option value="A4">A4 (210 √ó 297 mm)</option>
                                <option value="Letter" selected>Letter (8.5 √ó 11 in)</option>
                                <option value="Legal">Legal (8.5 √ó 14 in)</option>
                                <option value="A3">A3 (297 √ó 420 mm)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fontSize">Font Size for Separations:</label>
                            <input type="number" id="fontSize" value="36" min="12" max="72">
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="addPageNumbers" checked>
                            <label for="addPageNumbers">Add page numbers to separation pages</label>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn primary" id="combineBtn">
                            <i>üîó</i> Combine PDFs & Download
                        </button>
                        
                        <button class="action-btn secondary" id="clearAllBtn">
                            <i>üóëÔ∏è</i> Clear All Files
                        </button>
                        
                        <button class="action-btn secondary" id="saveProjectBtn">
                            <i>üíæ</i> Save Project
                        </button>
                        
                        <button class="action-btn secondary" id="loadProjectBtn">
                            <i>üìÇ</i> Load Project
                        </button>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div class="progress-container" id="progressContainer">
                    <div class="progress-text" id="progressText">Processing PDFs...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-details" id="progressDetails">Preparing documents...</div>
                </div>
            </div>

            <footer>
                <p>PDF Combiner Pro &copy; 2024 | Logged in as: <span id="footerUser">User</span></p>
                <p>Session started: <span id="sessionStart">Just now</span></p>
            </footer>
        </div>
    </div>

    <!-- Separation Page Modal -->
    <div class="modal" id="separationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Customize Separation Page</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="sepText">Page Text:</label>
                    <input type="text" id="sepText" placeholder="Enter text for separation page">
                </div>
                
                <div class="form-group">
                    <label for="sepPosition">Insert After:</label>
                    <select id="sepPosition">
                        <option value="0">Before first PDF</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Text Color:</label>
                    <div class="color-picker">
                        <input type="color" id="textColor" value="#000000">
                        <span>Black (#000000)</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Background Color:</label>
                    <div class="color-picker">
                        <input type="color" id="backgroundColor" value="#f0f0f0">
                        <span>Light Gray (#f0f0f0)</span>
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="addBorder">
                    <label for="addBorder">Add border around text</label>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="action-btn secondary" id="cancelSeparation">Cancel</button>
                <button class="action-btn primary" id="saveSeparation">Add Separation Page</button>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-content">
            <div class="modal-header">
                <h3>User Profile</h3>
                <button class="close-modal" id="closeProfileModal">&times;</button>
            </div>
            
            <div class="profile-info">
                <div class="profile-item">
                    <span class="profile-label">Name:</span>
                    <span class="profile-value" id="profileName">John Doe</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Email:</span>
                    <span class="profile-value" id="profileEmail">user@example.com</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Account Type:</span>
                    <span class="profile-value" id="profileRole">User</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Member Since:</span>
                    <span class="profile-value" id="profileDate">2024-01-01</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Total Combines:</span>
                    <span class="profile-value" id="profileCombines">0</span>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="action-btn secondary" id="closeProfile">Close</button>
                <button class="action-btn primary" id="editProfile">Edit Profile</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button class="close-modal" id="closePasswordModal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="currentPassword">Current Password:</label>
                    <input type="password" id="currentPassword" placeholder="Enter current password">
                </div>
                
                <div class="form-group">
                    <label for="newPassword">New Password:</label>
                    <input type="password" id="newPassword" placeholder="Enter new password">
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password:</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm new password">
                </div>
                
                <div class="password-requirements">
                    <div class="requirement" id="newReqLength">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>At least 8 characters</span>
                    </div>
                    <div class="requirement" id="newReqUppercase">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>One uppercase letter</span>
                    </div>
                    <div class="requirement" id="newReqLowercase">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>One lowercase letter</span>
                    </div>
                    <div class="requirement" id="newReqNumber">
                        <span class="requirement-icon">‚Ä¢</span>
                        <span>One number</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="action-btn secondary" id="cancelPassword">Cancel</button>
                <button class="action-btn primary" id="savePassword">Change Password</button>
            </div>
        </div>
    </div>

    <!-- Users Management Modal -->
    <div class="users-modal" id="usersModal">
        <div class="users-content">
            <div class="modal-header">
                <h3>Users Management</h3>
                <button class="close-modal" id="closeUsersModal">&times;</button>
            </div>
            
            <div class="users-list" id="usersList">
                <!-- Users will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button class="action-btn secondary" id="closeUsers">Close</button>
                <button class="action-btn primary" id="addUserBtn">Add New User</button>
            </div>
        </div>
    </div>

    <script>
        // Complete User Management System
        class UserAuthSystem {
            constructor() {
                this.currentUser = null;
                this.users = {};
                this.sessions = {};
                this.isLoggedIn = false;
                this.sessionStartTime = null;
                this.sessionTimer = null;
                
                this.initializeElements();
                this.bindEvents();
                this.loadUsers();
                this.checkRememberedUser();
                this.setupPasswordValidation();
            }
            
            initializeElements() {
                // Auth elements
                this.elements = {
                    // Tabs
                    authTabs: document.querySelectorAll('.auth-tab'),
                    
                    // Forms
                    loginForm: document.getElementById('loginForm'),
                    registerForm: document.getElementById('registerForm'),
                    
                    // Login form elements
                    loginEmail: document.getElementById('loginEmail'),
                    loginPassword: document.getElementById('loginPassword'),
                    loginBtn: document.getElementById('loginBtn'),
                    loginMessage: document.getElementById('loginMessage'),
                    rememberMe: document.getElementById('rememberMe'),
                    showRegister: document.getElementById('showRegister'),
                    
                    // Register form elements
                    registerName: document.getElementById('registerName'),
                    registerEmail: document.getElementById('registerEmail'),
                    registerPassword: document.getElementById('registerPassword'),
                    registerConfirmPassword: document.getElementById('registerConfirmPassword'),
                    registerBtn: document.getElementById('registerBtn'),
                    registerMessage: document.getElementById('registerMessage'),
                    showLogin: document.getElementById('showLogin'),
                    
                    // Password requirements
                    reqLength: document.getElementById('reqLength'),
                    reqUppercase: document.getElementById('reqUppercase'),
                    reqLowercase: document.getElementById('reqLowercase'),
                    reqNumber: document.getElementById('reqNumber'),
                    
                    // App elements
                    authContainer: document.getElementById('authContainer'),
                    appContainer: document.getElementById('appContainer'),
                    logoutBtn: document.getElementById('logoutBtn'),
                    userName: document.getElementById('userName'),
                    userAvatar: document.getElementById('userAvatar'),
                    footerUser: document.getElementById('footerUser'),
                    
                    // Profile elements
                    profileBtn: document.getElementById('profileBtn'),
                    profileModal: document.getElementById('profileModal'),
                    closeProfileModal: document.getElementById('closeProfileModal'),
                    closeProfile: document.getElementById('closeProfile'),
                    editProfile: document.getElementById('editProfile'),
                    profileName: document.getElementById('profileName'),
                    profileEmail: document.getElementById('profileEmail'),
                    profileRole: document.getElementById('profileRole'),
                    profileDate: document.getElementById('profileDate'),
                    profileCombines: document.getElementById('profileCombines'),
                    
                    // Users management
                    usersBtn: document.getElementById('usersBtn'),
                    usersModal: document.getElementById('usersModal'),
                    closeUsersModal: document.getElementById('closeUsersModal'),
                    closeUsers: document.getElementById('closeUsers'),
                    usersList: document.getElementById('usersList'),
                    addUserBtn: document.getElementById('addUserBtn'),
                    
                    // Password change
                    changePasswordBtn: document.getElementById('changePasswordBtn'),
                    passwordModal: document.getElementById('passwordModal'),
                    closePasswordModal: document.getElementById('closePasswordModal'),
                    cancelPassword: document.getElementById('cancelPassword'),
                    savePassword: document.getElementById('savePassword'),
                    currentPassword: document.getElementById('currentPassword'),
                    newPassword: document.getElementById('newPassword'),
                    confirmPassword: document.getElementById('confirmPassword'),
                    
                    // Admin panel
                    adminPanel: document.getElementById('adminPanel'),
                    adminToggle: document.getElementById('adminToggle'),
                    adminClose: document.getElementById('adminClose'),
                    userRole: document.getElementById('userRole'),
                    sessionTime: document.getElementById('sessionTime'),
                    pdfCount: document.getElementById('pdfCount'),
                    combineCount: document.getElementById('combineCount'),
                    sessionStart: document.getElementById('sessionStart'),
                    storageUsed: document.getElementById('storageUsed'),
                    usersOnline: document.getElementById('usersOnline'),
                    
                    // Data management
                    exportDataBtn: document.getElementById('exportDataBtn'),
                    clearDataBtn: document.getElementById('clearDataBtn'),
                    
                    // Password validation for change password
                    newReqLength: document.getElementById('newReqLength'),
                    newReqUppercase: document.getElementById('newReqUppercase'),
                    newReqLowercase: document.getElementById('newReqLowercase'),
                    newReqNumber: document.getElementById('newReqNumber')
                };
            }
            
            bindEvents() {
                // Tab switching
                this.elements.authTabs.forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });
                
                // Form switching
                this.elements.showRegister.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.switchTab('register');
                });
                
                this.elements.showLogin.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.switchTab('login');
                });
                
                // Login/Register buttons
                this.elements.loginBtn.addEventListener('click', () => this.login());
                this.elements.registerBtn.addEventListener('click', () => this.register());
                
                // Password toggle
                document.querySelectorAll('.toggle-password').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const target = e.target.dataset.target;
                        const input = document.getElementById(target);
                        const type = input.getAttribute('type');
                        input.setAttribute('type', type === 'password' ? 'text' : 'password');
                    });
                });
                
                // Password validation on input
                this.elements.registerPassword.addEventListener('input', () => this.validatePassword());
                this.elements.newPassword.addEventListener('input', () => this.validateNewPassword());
                
                // Logout
                this.elements.logoutBtn.addEventListener('click', () => this.logout());
                
                // Profile
                this.elements.profileBtn.addEventListener('click', () => this.showProfile());
                this.elements.closeProfileModal.addEventListener('click', () => this.hideProfile());
                this.elements.closeProfile.addEventListener('click', () => this.hideProfile());
                this.elements.editProfile.addEventListener('click', () => this.editProfile());
                
                // Users management
                this.elements.usersBtn.addEventListener('click', () => this.showUsers());
                this.elements.closeUsersModal.addEventListener('click', () => this.hideUsers());
                this.elements.closeUsers.addEventListener('click', () => this.hideUsers());
                this.elements.addUserBtn.addEventListener('click', () => this.addUser());
                
                // Password change
                this.elements.changePasswordBtn.addEventListener('click', () => this.showPasswordModal());
                this.elements.closePasswordModal.addEventListener('click', () => this.hidePasswordModal());
                this.elements.cancelPassword.addEventListener('click', () => this.hidePasswordModal());
                this.elements.savePassword.addEventListener('click', () => this.changePassword());
                
                // Admin panel
                this.elements.adminToggle.addEventListener('click', () => this.toggleAdminPanel());
                this.elements.adminClose.addEventListener('click', () => this.closeAdminPanel());
                
                // Data management
                this.elements.exportDataBtn.addEventListener('click', () => this.exportUserData());
                this.elements.clearDataBtn.addEventListener('click', () => this.clearUserData());
                
                // Close modals on outside click
                document.addEventListener('click', (e) => {
                    if (e.target === this.elements.profileModal) this.hideProfile();
                    if (e.target === this.elements.usersModal) this.hideUsers();
                    if (e.target === this.elements.passwordModal) this.hidePasswordModal();
                });
            }
            
            setupPasswordValidation() {
                // Setup password requirement validation
                this.passwordRequirements = {
                    length: /.{8,}/,
                    uppercase: /[A-Z]/,
                    lowercase: /[a-z]/,
                    number: /[0-9]/
                };
            }
            
            loadUsers() {
                try {
                    const storedUsers = localStorage.getItem('pdfCombinerUsers');
                    if (storedUsers) {
                        this.users = JSON.parse(storedUsers);
                    } else {
                        // Create default admin user
                        this.createDefaultAdmin();
                    }
                } catch (error) {
                    console.error('Error loading users:', error);
                    this.createDefaultAdmin();
                }
                
                // Load sessions
                try {
                    const storedSessions = localStorage.getItem('pdfCombinerSessions');
                    if (storedSessions) {
                        this.sessions = JSON.parse(storedSessions);
                    }
                } catch (error) {
                    console.error('Error loading sessions:', error);
                    this.sessions = {};
                }
            }
            
            createDefaultAdmin() {
                const adminEmail = 'admin@example.com';
                const adminPassword = 'password123';
                const hashedPassword = CryptoJS.SHA256(adminPassword).toString();
                
                this.users = {
                    [adminEmail]: {
                        id: this.generateUserId(),
                        name: 'Administrator',
                        email: adminEmail,
                        password: hashedPassword,
                        role: 'admin',
                        createdAt: new Date().toISOString(),
                        lastLogin: null,
                        combineCount: 0,
                        pdfCount: 0
                    }
                };
                
                this.saveUsers();
            }
            
            generateUserId() {
                return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            saveUsers() {
                try {
                    localStorage.setItem('pdfCombinerUsers', JSON.stringify(this.users));
                } catch (error) {
                    console.error('Error saving users:', error);
                    this.showAuthMessage(this.elements.registerMessage, 'Error saving user data', 'error');
                }
            }
            
            saveSessions() {
                try {
                    localStorage.setItem('pdfCombinerSessions', JSON.stringify(this.sessions));
                } catch (error) {
                    console.error('Error saving sessions:', error);
                }
            }
            
            switchTab(tab) {
                // Update tabs
                this.elements.authTabs.forEach(t => {
                    t.classList.toggle('active', t.dataset.tab === tab);
                });
                
                // Update forms
                if (tab === 'login') {
                    this.elements.loginForm.classList.remove('hidden');
                    this.elements.registerForm.classList.add('hidden');
                } else {
                    this.elements.loginForm.classList.add('hidden');
                    this.elements.registerForm.classList.remove('hidden');
                }
                
                // Clear messages
                this.hideAuthMessage(this.elements.loginMessage);
                this.hideAuthMessage(this.elements.registerMessage);
            }
            
            validatePassword() {
                const password = this.elements.registerPassword.value;
                
                // Check each requirement
                const requirements = {
                    length: this.passwordRequirements.length.test(password),
                    uppercase: this.passwordRequirements.uppercase.test(password),
                    lowercase: this.passwordRequirements.lowercase.test(password),
                    number: this.passwordRequirements.number.test(password)
                };
                
                // Update UI
                this.updateRequirementUI(this.elements.reqLength, requirements.length);
                this.updateRequirementUI(this.elements.reqUppercase, requirements.uppercase);
                this.updateRequirementUI(this.elements.reqLowercase, requirements.lowercase);
                this.updateRequirementUI(this.elements.reqNumber, requirements.number);
                
                return Object.values(requirements).every(req => req === true);
            }
            
            validateNewPassword() {
                const password = this.elements.newPassword.value;
                
                const requirements = {
                    length: this.passwordRequirements.length.test(password),
                    uppercase: this.passwordRequirements.uppercase.test(password),
                    lowercase: this.passwordRequirements.lowercase.test(password),
                    number: this.passwordRequirements.number.test(password)
                };
                
                this.updateRequirementUI(this.elements.newReqLength, requirements.length);
                this.updateRequirementUI(this.elements.newReqUppercase, requirements.uppercase);
                this.updateRequirementUI(this.elements.newReqLowercase, requirements.lowercase);
                this.updateRequirementUI(this.elements.newReqNumber, requirements.number);
                
                return Object.values(requirements).every(req => req === true);
            }
            
            updateRequirementUI(element, isValid) {
                element.classList.toggle('valid', isValid);
                element.classList.toggle('invalid', !isValid);
                element.querySelector('.requirement-icon').textContent = isValid ? '‚úì' : '‚Ä¢';
            }
            
            login() {
                const email = this.elements.loginEmail.value.trim().toLowerCase();
                const password = this.elements.loginPassword.value;
                const rememberMe = this.elements.rememberMe.checked;
                
                if (!email || !password) {
                    this.showAuthMessage(this.elements.loginMessage, 'Please enter both email and password', 'error');
                    return;
                }
                
                // Disable login button
                this.elements.loginBtn.disabled = true;
                this.elements.loginBtn.textContent = 'Signing in...';
                
                // Simulate network delay
                setTimeout(() => {
                    if (this.authenticateUser(email, password)) {
                        this.currentUser = this.users[email];
                        this.isLoggedIn = true;
                        
                        // Update user stats
                        this.currentUser.lastLogin = new Date().toISOString();
                        this.saveUsers();
                        
                        // Save session
                        if (rememberMe) {
                            this.saveUserSession();
                        }
                        
                        // Show app
                        this.showApp();
                        
                        // Show success message
                        this.showAuthMessage(this.elements.loginMessage, 'Login successful!', 'success');
                        
                        // Clear form
                        setTimeout(() => {
                            this.elements.loginEmail.value = '';
                            this.elements.loginPassword.value = '';
                            this.elements.loginBtn.disabled = false;
                            this.elements.loginBtn.textContent = 'Sign In';
                            this.hideAuthMessage(this.elements.loginMessage);
                        }, 2000);
                    } else {
                        this.showAuthMessage(this.elements.loginMessage, 'Invalid email or password', 'error');
                        this.elements.loginBtn.disabled = false;
                        this.elements.loginBtn.textContent = 'Sign In';
                    }
                }, 1000);
            }
            
            authenticateUser(email, password) {
                const user = this.users[email];
                if (!user) return false;
                
                const hashedPassword = CryptoJS.SHA256(password).toString();
                return user.password === hashedPassword;
            }
            
            register() {
                const name = this.elements.registerName.value.trim();
                const email = this.elements.registerEmail.value.trim().toLowerCase();
                const password = this.elements.registerPassword.value;
                const confirmPassword = this.elements.registerConfirmPassword.value;
                
                // Validation
                if (!name || !email || !password || !confirmPassword) {
                    this.showAuthMessage(this.elements.registerMessage, 'Please fill in all fields', 'error');
                    return;
                }
                
                if (!this.validateEmail(email)) {
                    this.showAuthMessage(this.elements.registerMessage, 'Please enter a valid email address', 'error');
                    return;
                }
                
                if (!this.validatePassword()) {
                    this.showAuthMessage(this.elements.registerMessage, 'Password does not meet requirements', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    this.showAuthMessage(this.elements.registerMessage, 'Passwords do not match', 'error');
                    return;
                }
                
                if (this.users[email]) {
                    this.showAuthMessage(this.elements.registerMessage, 'Email already registered', 'error');
                    return;
                }
                
                // Disable register button
                this.elements.registerBtn.disabled = true;
                this.elements.registerBtn.textContent = 'Creating account...';
                
                // Create user
                setTimeout(() => {
                    const hashedPassword = CryptoJS.SHA256(password).toString();
                    
                    this.users[email] = {
                        id: this.generateUserId(),
                        name: name,
                        email: email,
                        password: hashedPassword,
                        role: 'user',
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        combineCount: 0,
                        pdfCount: 0
                    };
                    
                    this.saveUsers();
                    
                    // Auto login
                    this.currentUser = this.users[email];
                    this.isLoggedIn = true;
                    
                    // Show app
                    this.showApp();
                    
                    // Show success message
                    this.showAuthMessage(this.elements.registerMessage, 'Account created successfully!', 'success');
                    
                    // Clear form
                    setTimeout(() => {
                        this.elements.registerName.value = '';
                        this.elements.registerEmail.value = '';
                        this.elements.registerPassword.value = '';
                        this.elements.registerConfirmPassword.value = '';
                        this.elements.registerBtn.disabled = false;
                        this.elements.registerBtn.textContent = 'Create Account';
                        this.hideAuthMessage(this.elements.registerMessage);
                    }, 2000);
                }, 1000);
            }
            
            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            checkRememberedUser() {
                try {
                    const remembered = localStorage.getItem('pdfCombinerRememberedUser');
                    if (remembered) {
                        const userData = JSON.parse(remembered);
                        if (userData.email && this.users[userData.email]) {
                            this.currentUser = this.users[userData.email];
                            this.isLoggedIn = true;
                            this.showApp();
                        }
                    }
                } catch (error) {
                    console.error('Error checking remembered user:', error);
                }
            }
            
            saveUserSession() {
                if (this.currentUser) {
                    const sessionData = {
                        email: this.currentUser.email,
                        timestamp: Date.now()
                    };
                    localStorage.setItem('pdfCombinerRememberedUser', JSON.stringify(sessionData));
                }
            }
            
            showApp() {
                // Hide auth, show app
                this.elements.authContainer.style.display = 'none';
                this.elements.appContainer.classList.add('active');
                
                // Update user info
                this.updateUserInfo();
                
                // Start session timer
                this.startSessionTimer();
                
                // Initialize PDF combiner
                if (!window.pdfCombiner) {
                    window.pdfCombiner = new PDFCombinerApp(this);
                }
                
                // Show/hide admin buttons based on role
                if (this.currentUser.role === 'admin') {
                    this.elements.usersBtn.style.display = 'block';
                }
                
                // Update storage usage
                this.updateStorageUsage();
            }
            
            updateUserInfo() {
                if (this.currentUser) {
                    this.elements.userName.textContent = this.currentUser.name;
                    this.elements.footerUser.textContent = this.currentUser.email;
                    this.elements.userAvatar.textContent = this.currentUser.name.charAt(0).toUpperCase();
                    this.elements.userRole.textContent = this.currentUser.role;
                    
                    // Update profile modal
                    this.elements.profileName.textContent = this.currentUser.name;
                    this.elements.profileEmail.textContent = this.currentUser.email;
                    this.elements.profileRole.textContent = this.currentUser.role;
                    this.elements.profileDate.textContent = new Date(this.currentUser.createdAt).toLocaleDateString();
                    this.elements.profileCombines.textContent = this.currentUser.combineCount || 0;
                }
            }
            
            startSessionTimer() {
                this.sessionStartTime = Date.now();
                this.sessionStartTimeFormatted = new Date().toLocaleString();
                this.elements.sessionStart.textContent = 'Just now';
                
                // Update session time every minute
                this.sessionTimer = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.sessionStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    this.elements.sessionTime.textContent = `${minutes}m ${seconds}s`;
                    
                    // Update session start display
                    const elapsedMinutes = Math.floor(elapsed / 60);
                    if (elapsedMinutes === 0) {
                        this.elements.sessionStart.textContent = 'Just now';
                    } else if (elapsedMinutes === 1) {
                        this.elements.sessionStart.textContent = '1 minute ago';
                    } else {
                        this.elements.sessionStart.textContent = `${elapsedMinutes} minutes ago`;
                    }
                }, 1000);
            }
            
            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    // Clear session
                    localStorage.removeItem('pdfCombinerRememberedUser');
                    
                    // Reset state
                    this.currentUser = null;
                    this.isLoggedIn = false;
                    
                    // Clear timers
                    clearInterval(this.sessionTimer);
                    
                    // Hide app, show auth
                    this.elements.appContainer.classList.remove('active');
                    this.elements.authContainer.style.display = 'block';
                    
                    // Clear forms
                    this.elements.loginEmail.value = '';
                    this.elements.loginPassword.value = '';
                    this.switchTab('login');
                    
                    // Show logout message
                    this.showAuthMessage(this.elements.loginMessage, 'You have been logged out', 'success');
                    setTimeout(() => this.hideAuthMessage(this.elements.loginMessage), 3000);
                }
            }
            
            showProfile() {
                this.elements.profileModal.style.display = 'flex';
            }
            
            hideProfile() {
                this.elements.profileModal.style.display = 'none';
            }
            
            editProfile() {
                const newName = prompt('Enter new name:', this.currentUser.name);
                if (newName && newName.trim()) {
                    this.currentUser.name = newName.trim();
                    this.users[this.currentUser.email].name = newName.trim();
                    this.saveUsers();
                    this.updateUserInfo();
                    alert('Profile updated successfully!');
                }
            }
            
            showUsers() {
                if (this.currentUser.role !== 'admin') return;
                
                this.elements.usersModal.style.display = 'flex';
                this.loadUsersList();
            }
            
            hideUsers() {
                this.elements.usersModal.style.display = 'none';
            }
            
            loadUsersList() {
                this.elements.usersList.innerHTML = '';
                
                Object.values(this.users).forEach(user => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <div class="user-email">${user.email}</div>
                            <div class="user-date">Joined: ${new Date(user.createdAt).toLocaleDateString()}</div>
                        </div>
                        <div class="user-role">${user.role}</div>
                    `;
                    this.elements.usersList.appendChild(userItem);
                });
                
                // Update online users count
                this.elements.usersOnline.textContent = Object.keys(this.users).length;
            }
            
            addUser() {
                const email = prompt('Enter email for new user:');
                if (!email || !this.validateEmail(email)) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                if (this.users[email]) {
                    alert('User already exists!');
                    return;
                }
                
                const name = prompt('Enter name for new user:');
                if (!name) {
                    alert('Name is required');
                    return;
                }
                
                const password = prompt('Enter temporary password (min 8 chars):');
                if (!password || password.length < 8) {
                    alert('Password must be at least 8 characters');
                    return;
                }
                
                const hashedPassword = CryptoJS.SHA256(password).toString();
                
                this.users[email] = {
                    id: this.generateUserId(),
                    name: name,
                    email: email,
                    password: hashedPassword,
                    role: 'user',
                    createdAt: new Date().toISOString(),
                    lastLogin: null,
                    combineCount: 0,
                    pdfCount: 0
                };
                
                this.saveUsers();
                this.loadUsersList();
                alert('User created successfully!');
            }
            
            showPasswordModal() {
                this.elements.passwordModal.style.display = 'flex';
            }
            
            hidePasswordModal() {
                this.elements.passwordModal.style.display = 'none';
                this.elements.currentPassword.value = '';
                this.elements.newPassword.value = '';
                this.elements.confirmPassword.value = '';
            }
            
            changePassword() {
                const currentPassword = this.elements.currentPassword.value;
                const newPassword = this.elements.newPassword.value;
                const confirmPassword = this.elements.confirmPassword.value;
                
                if (!currentPassword || !newPassword || !confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }
                
                if (!this.validateNewPassword()) {
                    alert('New password does not meet requirements');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('New passwords do not match');
                    return;
                }
                
                // Verify current password
                const hashedCurrent = CryptoJS.SHA256(currentPassword).toString();
                if (hashedCurrent !== this.currentUser.password) {
                    alert('Current password is incorrect');
                    return;
                }
                
                // Update password
                const hashedNew = CryptoJS.SHA256(newPassword).toString();
                this.currentUser.password = hashedNew;
                this.users[this.currentUser.email].password = hashedNew;
                this.saveUsers();
                
                this.hidePasswordModal();
                alert('Password changed successfully!');
            }
            
            toggleAdminPanel() {
                this.elements.adminPanel.classList.toggle('open');
            }
            
            closeAdminPanel() {
                this.elements.adminPanel.classList.remove('open');
            }
            
            updateStorageUsage() {
                try {
                    let totalSize = 0;
                    
                    // Calculate local storage usage
                    for (let key in localStorage) {
                        if (localStorage.hasOwnProperty(key)) {
                            totalSize += localStorage[key].length * 2; // Approximate size in bytes
                        }
                    }
                    
                    // Format size
                    let sizeFormatted;
                    if (totalSize < 1024) {
                        sizeFormatted = totalSize + ' B';
                    } else if (totalSize < 1024 * 1024) {
                        sizeFormatted = (totalSize / 1024).toFixed(2) + ' KB';
                    } else {
                        sizeFormatted = (totalSize / (1024 * 1024)).toFixed(2) + ' MB';
                    }
                    
                    this.elements.storageUsed.textContent = sizeFormatted;
                } catch (error) {
                    console.error('Error calculating storage:', error);
                }
            }
            
            exportUserData() {
                if (!this.currentUser) return;
                
                const userData = {
                    userInfo: this.currentUser,
                    pdfProjects: JSON.parse(localStorage.getItem(`pdfProjects_${this.currentUser.email}`) || '[]'),
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(userData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `pdf-combiner-data-${this.currentUser.email}-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('User data exported successfully!');
            }
            
            clearUserData() {
                if (confirm('Are you sure you want to clear all your data? This cannot be undone.')) {
                    // Clear user-specific data
                    localStorage.removeItem(`pdfProjects_${this.currentUser.email}`);
                    
                    // Reset user stats
                    this.currentUser.combineCount = 0;
                    this.currentUser.pdfCount = 0;
                    this.users[this.currentUser.email] = this.currentUser;
                    this.saveUsers();
                    
                    // Update UI
                    this.updateUserInfo();
                    this.elements.pdfCount.textContent = '0';
                    this.elements.combineCount.textContent = '0';
                    
                    alert('All your data has been cleared!');
                }
            }
            
            showAuthMessage(element, message, type) {
                element.textContent = message;
                element.className = `auth-message ${type}`;
                element.style.display = 'block';
            }
            
            hideAuthMessage(element) {
                element.style.display = 'none';
            }
            
            // Method to update user stats from PDF combiner
            updateUserStats(pdfCount, combineCount) {
                if (this.currentUser) {
                    this.currentUser.pdfCount = (this.currentUser.pdfCount || 0) + pdfCount;
                    this.currentUser.combineCount = (this.currentUser.combineCount || 0) + combineCount;
                    this.users[this.currentUser.email] = this.currentUser;
                    this.saveUsers();
                    
                    // Update UI
                    this.elements.pdfCount.textContent = this.currentUser.pdfCount;
                    this.elements.combineCount.textContent = this.currentUser.combineCount;
                    this.elements.profileCombines.textContent = this.currentUser.combineCount;
                }
            }
        }

        // PDF Combiner Application (Updated to work with auth system)
        class PDFCombinerApp {
            constructor(authSystem) {
                this.auth = authSystem;
                this.pdfFiles = [];
                this.separationPages = [];
                this.currentSeparationIndex = null;
                this.userEmail = authSystem.currentUser.email;
                
                this.initializeElements();
                this.bindEvents();
                this.loadUserProjects();
                this.updatePageCount();
            }
            
            initializeElements() {
                this.elements = {
                    dropArea: document.getElementById('dropArea'),
                    fileInput: document.getElementById('fileInput'),
                    fileList: document.getElementById('fileList'),
                    addSeparationBtn: document.getElementById('addSeparationBtn'),
                    separationsList: document.getElementById('separationsList'),
                    previewList: document.getElementById('previewList'),
                    combineBtn: document.getElementById('combineBtn'),
                    clearAllBtn: document.getElementById('clearAllBtn'),
                    saveProjectBtn: document.getElementById('saveProjectBtn'),
                    loadProjectBtn: document.getElementById('loadProjectBtn'),
                    separationModal: document.getElementById('separationModal'),
                    closeModal: document.getElementById('closeModal'),
                    cancelSeparation: document.getElementById('cancelSeparation'),
                    saveSeparation: document.getElementById('saveSeparation'),
                    sepText: document.getElementById('sepText'),
                    sepPosition: document.getElementById('sepPosition'),
                    textColor: document.getElementById('textColor'),
                    backgroundColor: document.getElementById('backgroundColor'),
                    addBorder: document.getElementById('addBorder'),
                    outputName: document.getElementById('outputName'),
                    pageSize: document.getElementById('pageSize'),
                    fontSize: document.getElementById('fontSize'),
                    addPageNumbers: document.getElementById('addPageNumbers'),
                    progressContainer: document.getElementById('progressContainer'),
                    progressFill: document.getElementById('progressFill'),
                    progressText: document.getElementById('progressText'),
                    progressDetails: document.getElementById('progressDetails'),
                    uploadStatus: document.getElementById('uploadStatus'),
                    separationStatus: document.getElementById('separationStatus'),
                    totalPagesCount: document.getElementById('totalPagesCount')
                };
            }
            
            bindEvents() {
                // File upload events
                this.elements.dropArea.addEventListener('click', () => this.elements.fileInput.click());
                this.elements.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
                
                // Drag and drop events
                this.elements.dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.elements.dropArea.classList.add('drag-over');
                });
                
                this.elements.dropArea.addEventListener('dragleave', () => {
                    this.elements.dropArea.classList.remove('drag-over');
                });
                
                this.elements.dropArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.elements.dropArea.classList.remove('drag-over');
                    this.handleFileDrop(e);
                });
                
                // Separation page events
                this.elements.addSeparationBtn.addEventListener('click', () => this.openSeparationModal());
                this.elements.closeModal.addEventListener('click', () => this.closeModal());
                this.elements.cancelSeparation.addEventListener('click', () => this.closeModal());
                this.elements.saveSeparation.addEventListener('click', () => this.saveSeparation());
                
                // Preset buttons
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const text = e.target.dataset.text;
                        this.openSeparationModal(text);
                    });
                });
                
                // Action buttons
                this.elements.combineBtn.addEventListener('click', () => this.combinePDFs());
                this.elements.clearAllBtn.addEventListener('click', () => this.clearAll());
                this.elements.saveProjectBtn.addEventListener('click', () => this.saveProject());
                this.elements.loadProjectBtn.addEventListener('click', () => this.loadProject());
                
                // Color picker events
                this.elements.textColor.addEventListener('input', (e) => {
                    e.target.nextElementSibling.textContent = `Selected (${e.target.value})`;
                });
                
                this.elements.backgroundColor.addEventListener('input', (e) => {
                    e.target.nextElementSibling.textContent = `Selected (${e.target.value})`;
                });
                
                // Input events
                this.elements.outputName.addEventListener('change', () => this.saveUserProjects());
                this.elements.fontSize.addEventListener('change', () => this.saveUserProjects());
                this.elements.pageSize.addEventListener('change', () => this.saveUserProjects());
                this.elements.addPageNumbers.addEventListener('change', () => this.saveUserProjects());
            }
            
            async handleFileUpload(event) {
                const files = Array.from(event.target.files);
                await this.processFiles(files);
                this.elements.fileInput.value = '';
            }
            
            async handleFileDrop(event) {
                const files = Array.from(event.dataTransfer.files).filter(file => 
                    file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')
                );
                await this.processFiles(files);
            }
            
            async processFiles(files) {
                if (files.length === 0) return;
                
                this.showStatus(this.elements.uploadStatus, `Uploading ${files.length} file(s)...`, 'success');
                
                for (const file of files) {
                    if (this.pdfFiles.length >= 10) {
                        this.showStatus(this.elements.uploadStatus, 'Maximum 10 PDF files allowed', 'error');
                        break;
                    }
                    
                    if (file.size > 50 * 1024 * 1024) {
                        this.showStatus(this.elements.uploadStatus, `File ${file.name} is too large (max 50MB)`, 'error');
                        continue;
                    }
                    
                    try {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                        const pageCount = pdfDoc.getPageCount();
                        
                        this.pdfFiles.push({
                            id: Date.now() + Math.random(),
                            name: file.name,
                            size: file.size,
                            file: file,
                            arrayBuffer: arrayBuffer,
                            pageCount: pageCount
                        });
                        
                        // Update user stats
                        this.auth.updateUserStats(1, 0);
                        
                        this.showStatus(this.elements.uploadStatus, `Added ${file.name} (${pageCount} pages)`, 'success');
                    } catch (error) {
                        this.showStatus(this.elements.uploadStatus, `Error reading ${file.name}: ${error.message}`, 'error');
                        console.error('Error reading PDF:', error);
                    }
                }
                
                this.updateFileList();
                this.updatePreview();
                this.updatePositionDropdown();
                this.updatePageCount();
                this.saveUserProjects();
                
                setTimeout(() => {
                    this.hideStatus(this.elements.uploadStatus);
                }, 3000);
            }
            
            updateFileList() {
                this.elements.fileList.innerHTML = '';
                
                if (this.pdfFiles.length === 0) {
                    this.elements.fileList.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #666;">
                            <i style="font-size: 3rem; display: block; margin-bottom: 10px;">üìÑ</i>
                            <p>No PDF files uploaded yet</p>
                        </div>
                    `;
                    return;
                }
                
                this.pdfFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.dataset.index = index;
                    fileItem.draggable = true;
                    
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${this.formatFileSize(file.size)} ‚Ä¢ ${file.pageCount} page(s)</div>
                        </div>
                        <div class="file-actions">
                            <button class="move-btn" title="Drag to reorder">‚ÜïÔ∏è</button>
                            <button class="delete-btn" title="Remove file" data-index="${index}">üóëÔ∏è</button>
                        </div>
                    `;
                    
                    this.elements.fileList.appendChild(fileItem);
                    
                    const deleteBtn = fileItem.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteFile(index);
                    });
                    
                    this.addFileDragEvents(fileItem, index);
                });
            }
            
            deleteFile(index) {
                if (confirm(`Are you sure you want to remove "${this.pdfFiles[index].name}"?`)) {
                    this.separationPages = this.separationPages.filter(sep => sep.position !== index);
                    this.separationPages = this.separationPages.map(sep => {
                        if (sep.position > index) {
                            return { ...sep, position: sep.position - 1 };
                        }
                        return sep;
                    });
                    
                    this.pdfFiles.splice(index, 1);
                    this.updateFileList();
                    this.updatePreview();
                    this.updatePositionDropdown();
                    this.updatePageCount();
                    this.saveUserProjects();
                    
                    this.showStatus(this.elements.uploadStatus, 'File removed', 'success');
                    setTimeout(() => this.hideStatus(this.elements.uploadStatus), 2000);
                }
            }
            
            openSeparationModal(presetText = '') {
                this.elements.sepText.value = presetText || '';
                this.elements.separationModal.style.display = 'flex';
                this.currentSeparationIndex = null;
            }
            
            closeModal() {
                this.elements.separationModal.style.display = 'none';
                this.elements.sepText.value = '';
                this.currentSeparationIndex = null;
            }
            
            saveSeparation() {
                const text = this.elements.sepText.value.trim();
                if (!text) {
                    alert('Please enter text for the separation page');
                    return;
                }
                
                const position = parseInt(this.elements.sepPosition.value);
                const textColor = this.elements.textColor.value;
                const backgroundColor = this.elements.backgroundColor.value;
                const addBorder = this.elements.addBorder.checked;
                
                const separation = {
                    id: Date.now() + Math.random(),
                    text: text,
                    position: position,
                    textColor: textColor,
                    backgroundColor: backgroundColor,
                    addBorder: addBorder
                };
                
                if (this.currentSeparationIndex !== null) {
                    this.separationPages[this.currentSeparationIndex] = separation;
                } else {
                    this.separationPages.push(separation);
                }
                
                this.updateSeparationsList();
                this.updatePreview();
                this.updatePageCount();
                this.saveUserProjects();
                this.closeModal();
                
                this.showStatus(this.elements.separationStatus, 'Separation page added', 'success');
                setTimeout(() => this.hideStatus(this.elements.separationStatus), 2000);
            }
            
            updateSeparationsList() {
                this.elements.separationsList.innerHTML = '';
                
                if (this.separationPages.length === 0) {
                    this.elements.separationsList.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #666;">
                            <p>No separation pages added yet</p>
                        </div>
                    `;
                    return;
                }
                
                this.separationPages.sort((a, b) => a.position - b.position);
                
                this.separationPages.forEach((sep, index) => {
                    const sepItem = document.createElement('div');
                    sepItem.className = 'separation-item';
                    
                    let positionText = 'Before first PDF';
                    if (sep.position === this.pdfFiles.length) {
                        positionText = 'After last PDF';
                    } else if (sep.position > 0 && sep.position < this.pdfFiles.length) {
                        positionText = `After PDF ${sep.position}`;
                    }
                    
                    sepItem.innerHTML = `
                        <div>
                            <div class="separation-text">${sep.text}</div>
                            <div class="separation-position">${positionText}</div>
                        </div>
                        <div class="separation-actions">
                            <button class="edit-btn" data-index="${index}">‚úèÔ∏è Edit</button>
                            <button class="delete-btn" data-index="${index}">üóëÔ∏è Delete</button>
                        </div>
                    `;
                    
                    this.elements.separationsList.appendChild(sepItem);
                    
                    const editBtn = sepItem.querySelector('.edit-btn');
                    const deleteBtn = sepItem.querySelector('.delete-btn');
                    
                    editBtn.addEventListener('click', () => this.editSeparation(index));
                    deleteBtn.addEventListener('click', () => this.deleteSeparation(index));
                });
            }
            
            editSeparation(index) {
                const sep = this.separationPages[index];
                this.elements.sepText.value = sep.text;
                this.elements.sepPosition.value = sep.position;
                this.elements.textColor.value = sep.textColor;
                this.elements.backgroundColor.value = sep.backgroundColor;
                this.elements.addBorder.checked = sep.addBorder;
                
                this.currentSeparationIndex = index;
                this.elements.separationModal.style.display = 'flex';
            }
            
            deleteSeparation(index) {
                if (confirm('Are you sure you want to delete this separation page?')) {
                    this.separationPages.splice(index, 1);
                    this.updateSeparationsList();
                    this.updatePreview();
                    this.updatePageCount();
                    this.saveUserProjects();
                    
                    this.showStatus(this.elements.separationStatus, 'Separation page removed', 'success');
                    setTimeout(() => this.hideStatus(this.elements.separationStatus), 2000);
                }
            }
            
            updatePreview() {
                this.elements.previewList.innerHTML = '';
                
                if (this.pdfFiles.length === 0 && this.separationPages.length === 0) {
                    this.elements.previewList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i style="font-size: 3rem; display: block; margin-bottom: 10px;">üìã</i>
                            <p>Upload PDFs and add separation pages to see preview here</p>
                        </div>
                    `;
                    return;
                }
                
                const sortedSeparations = [...this.separationPages].sort((a, b) => a.position - b.position);
                let sepIndex = 0;
                
                for (let i = 0; i <= this.pdfFiles.length; i++) {
                    while (sepIndex < sortedSeparations.length && sortedSeparations[sepIndex].position === i) {
                        const sep = sortedSeparations[sepIndex];
                        this.addPreviewItem('separation', sep.text, i, sepIndex);
                        sepIndex++;
                    }
                    
                    if (i < this.pdfFiles.length) {
                        const pdf = this.pdfFiles[i];
                        this.addPreviewItem('pdf', pdf.name, i);
                    }
                }
            }
            
            updatePositionDropdown() {
                this.elements.sepPosition.innerHTML = '';
                
                const beforeFirst = document.createElement('option');
                beforeFirst.value = 0;
                beforeFirst.textContent = 'Before first PDF';
                this.elements.sepPosition.appendChild(beforeFirst);
                
                for (let i = 1; i <= this.pdfFiles.length; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    
                    if (i === this.pdfFiles.length) {
                        option.textContent = 'After last PDF';
                    } else {
                        option.textContent = `After PDF ${i}`;
                    }
                    
                    this.elements.sepPosition.appendChild(option);
                }
            }
            
            updatePageCount() {
                let totalPages = 0;
                
                this.pdfFiles.forEach(pdf => {
                    totalPages += pdf.pageCount || 0;
                });
                
                totalPages += this.separationPages.length;
                this.elements.totalPagesCount.textContent = totalPages;
            }
            
            async combinePDFs() {
                if (this.pdfFiles.length === 0) {
                    alert('Please upload at least one PDF file');
                    return;
                }
                
                try {
                    this.showProgress('Preparing documents...', 0);
                    
                    const mergedPdf = await PDFLib.PDFDocument.create();
                    const pageSize = this.getPageSize(this.elements.pageSize.value);
                    
                    const sortedSeparations = [...this.separationPages].sort((a, b) => a.position - b.position);
                    
                    let sepIndex = 0;
                    let totalProcessed = 0;
                    const totalItems = this.pdfFiles.length + sortedSeparations.length;
                    
                    for (let i = 0; i <= this.pdfFiles.length; i++) {
                        while (sepIndex < sortedSeparations.length && sortedSeparations[sepIndex].position === i) {
                            const sep = sortedSeparations[sepIndex];
                            
                            this.updateProgress(`Creating separation page: "${sep.text}"`, 
                                (totalProcessed / totalItems) * 100);
                            
                            await this.addSeparationPage(mergedPdf, sep, pageSize);
                            
                            sepIndex++;
                            totalProcessed++;
                            
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                        
                        if (i < this.pdfFiles.length) {
                            const pdf = this.pdfFiles[i];
                            
                            this.updateProgress(`Adding PDF: ${pdf.name}`, 
                                (totalProcessed / totalItems) * 100);
                            
                            await this.addPDFPages(mergedPdf, pdf);
                            
                            totalProcessed++;
                            
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    }
                    
                    this.updateProgress('Finalizing document...', 90);
                    
                    const pdfBytes = await mergedPdf.save();
                    
                    this.updateProgress('Downloading...', 100);
                    
                    // Update user stats
                    this.auth.updateUserStats(0, 1);
                    
                    download(pdfBytes, this.elements.outputName.value, "application/pdf");
                    
                    setTimeout(() => {
                        this.hideProgress();
                        this.showStatus(this.elements.uploadStatus, 'PDF successfully combined and downloaded!', 'success');
                        setTimeout(() => this.hideStatus(this.elements.uploadStatus), 5000);
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error combining PDFs:', error);
                    this.hideProgress();
                    alert(`Error combining PDFs: ${error.message}`);
                }
            }
            
            clearAll() {
                if (this.pdfFiles.length === 0 && this.separationPages.length === 0) {
                    return;
                }
                
                if (confirm('Are you sure you want to clear all files and separation pages?')) {
                    this.pdfFiles = [];
                    this.separationPages = [];
                    
                    this.updateFileList();
                    this.updateSeparationsList();
                    this.updatePreview();
                    this.updatePageCount();
                    this.saveUserProjects();
                    
                    this.showStatus(this.elements.uploadStatus, 'All files cleared', 'success');
                    setTimeout(() => this.hideStatus(this.elements.uploadStatus), 3000);
                }
            }
            
            saveProject() {
                const project = {
                    pdfFiles: this.pdfFiles.map(pdf => ({
                        name: pdf.name,
                        size: pdf.size,
                        pageCount: pdf.pageCount
                    })),
                    separationPages: this.separationPages,
                    outputName: this.elements.outputName.value,
                    fontSize: this.elements.fontSize.value,
                    pageSize: this.elements.pageSize.value,
                    addPageNumbers: this.elements.addPageNumbers.checked,
                    timestamp: new Date().toISOString()
                };
                
                const projectJson = JSON.stringify(project, null, 2);
                const blob = new Blob([projectJson], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `pdf-combiner-project-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showStatus(this.elements.uploadStatus, 'Project saved successfully', 'success');
                setTimeout(() => this.hideStatus(this.elements.uploadStatus), 3000);
            }
            
            loadProject() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    try {
                        const text = await file.text();
                        const project = JSON.parse(text);
                        
                        if (!project.pdfFiles || !Array.isArray(project.pdfFiles)) {
                            throw new Error('Invalid project file format');
                        }
                        
                        this.showStatus(this.elements.uploadStatus, 'Loading project...', 'success');
                        
                        this.pdfFiles = [];
                        this.separationPages = project.separationPages || [];
                        
                        if (project.outputName) this.elements.outputName.value = project.outputName;
                        if (project.fontSize) this.elements.fontSize.value = project.fontSize;
                        if (project.pageSize) this.elements.pageSize.value = project.pageSize;
                        if (project.addPageNumbers !== undefined) {
                            this.elements.addPageNumbers.checked = project.addPageNumbers;
                        }
                        
                        this.updateFileList();
                        this.updateSeparationsList();
                        this.updatePreview();
                        this.updatePositionDropdown();
                        this.updatePageCount();
                        this.saveUserProjects();
                        
                        this.showStatus(this.elements.uploadStatus, 
                            'Project loaded! Note: You need to re-upload the PDF files.', 'success');
                        setTimeout(() => this.hideStatus(this.elements.uploadStatus), 5000);
                        
                    } catch (error) {
                        console.error('Error loading project:', error);
                        alert('Error loading project file: ' + error.message);
                    }
                };
                
                input.click();
            }
            
            saveUserProjects() {
                try {
                    const projectData = {
                        separationPages: this.separationPages,
                        outputName: this.elements.outputName.value,
                        fontSize: this.elements.fontSize.value,
                        pageSize: this.elements.pageSize.value,
                        addPageNumbers: this.elements.addPageNumbers.checked
                    };
                    
                    // Save per user
                    const userProjects = JSON.parse(localStorage.getItem(`pdfProjects_${this.userEmail}`) || '[]');
                    userProjects.push({
                        ...projectData,
                        savedAt: new Date().toISOString()
                    });
                    
                    // Keep only last 10 projects
                    if (userProjects.length > 10) {
                        userProjects.shift();
                    }
                    
                    localStorage.setItem(`pdfProjects_${this.userEmail}`, JSON.stringify(userProjects));
                } catch (error) {
                    console.error('Error saving user projects:', error);
                }
            }
            
            loadUserProjects() {
                try {
                    const userProjects = JSON.parse(localStorage.getItem(`pdfProjects_${this.userEmail}`) || '[]');
                    if (userProjects.length > 0) {
                        const latest = userProjects[userProjects.length - 1];
                        
                        if (latest.separationPages) this.separationPages = latest.separationPages;
                        if (latest.outputName) this.elements.outputName.value = latest.outputName;
                        if (latest.fontSize) this.elements.fontSize.value = latest.fontSize;
                        if (latest.pageSize) this.elements.pageSize.value = latest.pageSize;
                        if (latest.addPageNumbers !== undefined) {
                            this.elements.addPageNumbers.checked = latest.addPageNumbers;
                        }
                        
                        this.updateSeparationsList();
                        this.updatePositionDropdown();
                    }
                } catch (error) {
                    console.error('Error loading user projects:', error);
                }
            }
            
            // Helper methods
            showProgress(text, percent) {
                this.elements.progressContainer.style.display = 'block';
                this.elements.progressText.textContent = text;
                this.elements.progressFill.style.width = `${percent}%`;
                this.elements.progressDetails.textContent = `${Math.round(percent)}% complete`;
            }
            
            updateProgress(text, percent) {
                this.elements.progressText.textContent = text;
                this.elements.progressFill.style.width = `${percent}%`;
                this.elements.progressDetails.textContent = `${Math.round(percent)}% complete`;
            }
            
            hideProgress() {
                this.elements.progressContainer.style.display = 'none';
                this.elements.progressFill.style.width = '0%';
            }
            
            showStatus(element, message, type) {
                element.textContent = message;
                element.className = `status-message ${type}`;
                element.style.display = 'block';
            }
            
            hideStatus(element) {
                element.style.display = 'none';
            }
            
            getPageSize(sizeName) {
                const sizes = {
                    'A4': [595.28, 841.89],
                    'Letter': [612, 792],
                    'Legal': [612, 1008],
                    'A3': [841.89, 1190.55]
                };
                
                return sizes[sizeName] || sizes['Letter'];
            }
            
            hexToRgb(hex) {
                hex = hex.replace('#', '');
                const r = parseInt(hex.substring(0, 2), 16) / 255;
                const g = parseInt(hex.substring(2, 4), 16) / 255;
                const b = parseInt(hex.substring(4, 6), 16) / 255;
                
                return { r, g, b };
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // These methods would be implemented for PDF combining
            addPreviewItem(type, text, index, sepIndex = null) {
                const previewItem = document.createElement('div');
                previewItem.className = `preview-item ${type}`;
                previewItem.draggable = true;
                
                let subtitle = '';
                
                if (type === 'pdf') {
                    subtitle = `${this.pdfFiles[index].pageCount} page(s)`;
                } else {
                    subtitle = 'Separation page';
                }
                
                previewItem.innerHTML = `
                    <div class="preview-icon ${type}">${type === 'pdf' ? 'üìÑ' : 'üìù'}</div>
                    <div class="preview-content">
                        <div class="preview-title">${text}</div>
                        <div class="preview-subtitle">${subtitle}</div>
                    </div>
                `;
                
                this.elements.previewList.appendChild(previewItem);
            }
            
            addFileDragEvents(element, index) {
                // Drag implementation would go here
            }
            
            async addPDFPages(targetPdf, pdfFile) {
                try {
                    const pdfDoc = await PDFLib.PDFDocument.load(pdfFile.arrayBuffer);
                    const copiedPages = await targetPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    copiedPages.forEach(page => targetPdf.addPage(page));
                } catch (error) {
                    console.error(`Error adding PDF ${pdfFile.name}:`, error);
                    throw error;
                }
            }
            
            async addSeparationPage(targetPdf, separation, pageSize) {
                try {
                    const page = targetPdf.addPage(pageSize);
                    
                    const textColor = this.hexToRgb(separation.textColor);
                    const bgColor = this.hexToRgb(separation.backgroundColor);
                    
                    page.drawRectangle({
                        x: 0,
                        y: 0,
                        width: page.getWidth(),
                        height: page.getHeight(),
                        color: PDFLib.rgb(bgColor.r, bgColor.g, bgColor.b),
                    });
                    
                    const font = await targetPdf.embedFont(PDFLib.StandardFonts.HelveticaBold);
                    
                    const fontSize = parseInt(this.elements.fontSize.value);
                    const textWidth = font.widthOfTextAtSize(separation.text, fontSize);
                    const textHeight = font.heightAtSize(fontSize);
                    
                    const centerX = (page.getWidth() - textWidth) / 2;
                    const centerY = (page.getHeight() - textHeight) / 2;
                    
                    page.drawText(separation.text, {
                        x: centerX,
                        y: centerY,
                        size: fontSize,
                        font: font,
                        color: PDFLib.rgb(textColor.r, textColor.g, textColor.b),
                    });
                    
                    if (separation.addBorder) {
                        const borderPadding = 40;
                        page.drawRectangle({
                            x: borderPadding,
                            y: borderPadding,
                            width: page.getWidth() - (borderPadding * 2),
                            height: page.getHeight() - (borderPadding * 2),
                            borderColor: PDFLib.rgb(textColor.r, textColor.g, textColor.b),
                            borderWidth: 2,
                        });
                    }
                    
                    if (this.elements.addPageNumbers.checked) {
                        const pageNumber = targetPdf.getPageCount();
                        const smallFont = await targetPdf.embedFont(PDFLib.StandardFonts.Helvetica);
                        
                        page.drawText(`Page ${pageNumber}`, {
                            x: 50,
                            y: 50,
                            size: 12,
                            font: smallFont,
                            color: PDFLib.rgb(textColor.r, textColor.g, textColor.b),
                        });
                    }
                    
                } catch (error) {
                    console.error('Error creating separation page:', error);
                    throw error;
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.authSystem = new UserAuthSystem();
        });
    </script>
</body>
</html>